(function(t){function n(n){for(var r,a,o=n[0],u=n[1],c=n[2],d=0,f=[];d<o.length;d++)a=o[d],Object.prototype.hasOwnProperty.call(i,a)&&i[a]&&f.push(i[a][0]),i[a]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(t[r]=u[r]);l&&l(n);while(f.length)f.shift()();return s.push.apply(s,c||[]),e()}function e(){for(var t,n=0;n<s.length;n++){for(var e=s[n],r=!0,o=1;o<e.length;o++){var u=e[o];0!==i[u]&&(r=!1)}r&&(s.splice(n--,1),t=a(a.s=e[0]))}return t}var r={},i={app:0},s=[];function a(n){if(r[n])return r[n].exports;var e=r[n]={i:n,l:!1,exports:{}};return t[n].call(e.exports,e,e.exports,a),e.l=!0,e.exports}a.m=t,a.c=r,a.d=function(t,n,e){a.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:e})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,n){if(1&n&&(t=a(t)),8&n)return t;if(4&n&&"object"===typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(a.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var r in t)a.d(e,r,function(n){return t[n]}.bind(null,r));return e},a.n=function(t){var n=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(n,"a",n),n},a.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},a.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],u=o.push.bind(o);o.push=n,o=o.slice();for(var c=0;c<o.length;c++)n(o[c]);var l=u;s.push([0,"chunk-vendors"]),e()})({0:function(t,n,e){t.exports=e("56d7")},"034f":function(t,n,e){"use strict";var r=e("85ec"),i=e.n(r);i.a},1:function(t,n){},2:function(t,n){},3:function(t,n){},4:function(t,n){},5:function(t,n){},"56d7":function(t,n,e){"use strict";e.r(n);e("e260"),e("e6cf"),e("cca6"),e("a79d");var r=e("2b0e"),i=e("7591"),s=e.n(i),a=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",[e("sinkhorn-vis")],1)},o=[],u=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",[t._v(" Click to add a target point "),e("span",{staticClass:"target"},[t._v("⬤")]),t._v(". Hold down "),e("kbd",[t._v("shift")]),t._v(" to create source point "),e("span",{staticClass:"source"},[t._v("⬤")]),t._v(". Epsilon: "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.epsilonInput,expression:"epsilonInput"}],attrs:{placeholder:"Epsilon"},domProps:{value:t.epsilonInput},on:{change:t.handleEpsilonChange,input:function(n){n.target.composing||(t.epsilonInput=n.target.value)}}}),t._v(" Iters: "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.itersInput,expression:"itersInput"}],attrs:{placeholder:"Iters"},domProps:{value:t.itersInput},on:{change:t.handleItersChange,input:function(n){n.target.composing||(t.itersInput=n.target.value)}}}),t._v(" "),e("button",{on:{click:t.removeAllPoints}},[t._v(" Remove all points")]),e("br"),t._v(" Sinkhorn dist: "+t._s(t.sinkhornDist)+". "),e("v-stage",{ref:"stage",attrs:{config:t.stageSize},on:{click:t.handleClick}},[e("v-layer",{ref:"layer"},t._l(t.sources,(function(n){return e("v-circle",{key:n.id,attrs:{config:{x:n.x,y:n.y,radius:5,fill:"blue",id:n.id,draggable:!0}},on:{dragstart:t.handleDragstart,dragmove:t.handleDragmove,dragend:t.handleDragend}})})),1),e("v-layer",{ref:"layer2"},t._l(t.targets,(function(n){return e("v-circle",{key:n.id,attrs:{config:{x:n.x,y:n.y,radius:5,fill:"red",id:n.id,draggable:!0}},on:{dragstart:t.handleDragstart,dragmove:t.handleDragmove,dragend:t.handleDragend}})})),1),e("v-layer",{ref:"layer3"},t._l(t.arrows,(function(t){return e("v-line",{key:t.id,attrs:{config:{points:t.points,stroke:"black"}}})})),1),e("v-layer",{ref:"dragLayer"})],1)],1)},c=[],l=(e("7db0"),e("d81d"),e("4c53"),e("0b53")),d=window.innerWidth,f=window.innerHeight,h={data:function(){return{epsilonInput:.01,itersInput:10,iters:10,grad_sink_fn:function(t){return t},sink_fn:function(t){return t},sources:[],targets:[],arrows:[],sinkhornDist:0,stageSize:{width:d,height:f}}},methods:{handleEpsilonChange:function(){this.calculate()},handleItersChange:function(){this.calculate()},handleDragstart:function(t){this.dragItemId=t.target.id()},handleDragmove:function(t){var n=this,e=this.sources.find((function(t){return t.id===n.dragItemId}))||this.targets.find((function(t){return t.id===n.dragItemId}));e.x=t.target.x(),e.y=t.target.y(),this.calculate()},handleDragend:function(t){var n=this,e=this.sources.find((function(t){return t.id===n.dragItemId}))||this.targets.find((function(t){return t.id===n.dragItemId}));e.x=t.target.x(),e.y=t.target.y(),this.calculate(),this.dragItemId=null},handleClick:function(t){var n=t.target.getStage(),e=n.getPointerPosition();e.id=this.nextId,this.nextId+=1,event.shiftKey?this.sources.push(e):this.targets.push(e),this.save(),this.calculate()},removeAllPoints:function(){this.sources=[],this.targets=[],this.arrows=[],this.calculate()},updateInputs:function(){var t=this.sources.map((function(t){return[t.x,t.y]})),n=this.targets.map((function(t){return[t.x,t.y]}));t.length>0&&n.length>0&&(this.sources_tf=l.tensor2d(t),this.targets_tf=l.tensor2d(n)),this.iters=parseInt(this.itersInput),this.epsilon_tf=l.tensor(parseFloat(this.epsilonInput))},distanceMatrix:function(t,n){return l.sum(l.square(l.expandDims(t,1).sub(l.expandDims(n,0))),2)},calculate:function(){this.updateInputs(),this.sinkhornDist=this.sink_fn(this.sources_tf,this.targets_tf);for(var t=this.grad_sink_fn(this.sources_tf).neg(),n=[],e=0;e<this.sources.length;e++){var r=this.sources[e];n.push({points:[r.x,r.y,r.x+t.arraySync()[e][0],r.y+t.arraySync()[e][1]],id:e})}this.arrows=n},load:function(){this.nextId=1},save:function(){localStorage.setItem("sources",JSON.stringify(this.sources)),localStorage.setItem("targets",JSON.stringify(this.targets))},sinkhornStep:function(t,n,e){var r=l.logSumExp(l.neg(n).sub(l.transpose(t)).div(e),1).mul(e);return n=l.logSumExp(l.neg(r).sub(t).div(e),1).mul(e),[n,r]},sinkhorn:function(t,n,e){for(var r,i,s=t.shape[0],a=l.zeros([s]),o=0;o<e;o++)r=this.sinkhornStep(t,a,n),a=r[0],i=r[1];var u=l.expandDims(l.neg(a),1).sub(l.expandDims(i,0)).sub(t).div(n),c=l.sum(l.exp(u).mul(t));return c},initGraph:function(){var t=this;this.sources_tf=l.tensor2d([[0,0]],[1,2]),this.targets_tf=l.tensor2d([[0,0]],[1,2]),this.sink_fn=function(n,e){return t.sinkhorn(t.distanceMatrix(n,e),t.epsilon_tf,t.iters)},this.sink_from_sources_fn=function(n){return t.sink_fn(n,t.targets_tf)},this.grad_sink_fn=l.grad(this.sink_from_sources_fn)}},mounted:function(){this.initGraph(),this.load()}},p=h,g=(e("cbb6"),e("2877")),v=Object(g["a"])(p,u,c,!1,null,null,null),m=v.exports,_={name:"App",components:{SinkhornVis:m}},y=_,b=(e("034f"),Object(g["a"])(y,a,o,!1,null,null,null)),I=b.exports;r["default"].use(s.a),r["default"].config.productionTip=!1,new r["default"]({render:function(t){return t(I)}}).$mount("#app")},5904:function(t,n,e){},6:function(t,n){},"85ec":function(t,n,e){},cbb6:function(t,n,e){"use strict";var r=e("5904"),i=e.n(r);i.a}});
//# sourceMappingURL=app.911a4010.js.map